<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Sans+Arabic:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gold: #d4af37;
            --primary-gold-dim: #aa8c2c;
            --deep-green: #081c15;
            --lighter-green: #1b4332;
            --glass-bg: rgba(20, 40, 30, 0.6);
            --glass-border: rgba(212, 175, 55, 0.2);
            --text-main: #e9f3e6;
            --active-ayah-bg: rgba(212, 175, 55, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); 
            background-attachment: fixed;
            min-height: 100vh;
            font-family: 'Noto Sans Arabic', sans-serif;
            color: var(--text-main);
            padding-bottom: 140px; /* Space for fixed player */
            overflow-y: scroll;
            scroll-behavior: smooth;
        }

        /* --- Layout --- */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Header & Controls --- */
        header {
            text-align: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 2;
        }

        h1 {
            font-family: 'Amiri', serif;
            font-size: 3.5rem;
            color: var(--primary-gold);
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            margin-bottom: 10px;
        }

        .controls-top {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        select {
            background: var(--glass-bg);
            color: #fff;
            border: 1px solid var(--glass-border);
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Noto Sans Arabic';
            cursor: pointer;
            backdrop-filter: blur(5px);
        }

        option { background: var(--deep-green); }

        /* --- Juz Grid --- */
        .juz-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 8px;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 25px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .juz-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid transparent;
            color: #aaa;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Amiri';
            font-size: 1.1rem;
        }

        .juz-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .juz-btn.active {
            background: var(--primary-gold);
            color: var(--deep-green);
            font-weight: bold;
            box-shadow: 0 0 15px var(--primary-gold-dim);
        }

        /* --- Quran Text Display (The Mushaf) --- */
        .mushaf-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            padding: 30px;
            min-height: 200px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .loading-overlay.visible { opacity: 1; pointer-events: all; }

        .ayah-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ayah-item {
            padding: 15px;
            border-radius: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ayah-item:hover { background: rgba(255,255,255,0.03); }
        
        .ayah-item.active {
            background: var(--active-ayah-bg);
            border-right: 4px solid var(--primary-gold);
            transform: scale(1.01);
        }

        .ayah-text {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
            line-height: 2.2;
            color: #fff;
            margin-bottom: 5px;
        }

        .ayah-info {
            font-size: 0.8rem;
            color: var(--primary-gold);
            opacity: 0.7;
            display: flex;
            justify-content: space-between;
        }

        /* --- Sticky Player --- */
        .player-dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px;
            background: rgba(15, 30, 25, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid var(--primary-gold);
            border-radius: 20px;
            padding: 15px 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #bbb;
        }

        .current-surah { color: var(--primary-gold); font-weight: bold; }

        .audio-controls-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .nav-btn {
            background: none;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            width: 50px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .nav-btn:hover { background: var(--primary-gold); border-color: var(--primary-gold); color: #000; }

        audio { width: 100%; height: 35px; }

        /* Loader */
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: var(--primary-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- Floating Scroll to Top Button --- */
        .scroll-top-btn {
            position: fixed;
            bottom: 100px; /* Positioned above the player dock */
            right: 20px;
            width: 45px;
            height: 45px;
            background-color: var(--primary-gold);
            color: var(--deep-green);
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
            z-index: 90;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-top-btn.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .scroll-top-btn:hover {
            background-color: #fff;
            transform: translateY(-5px);
        }

        @media (max-width: 600px) {
            h1 { font-size: 2.5rem; }
            .ayah-text { font-size: 1.4rem; }
            .player-dock { bottom: 10px; width: 96%; padding: 15px; }
            .juz-selector { max-height: 80px; }
            .scroll-top-btn { bottom: 130px; right: 5px; } /* Adjust for mobile */
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ</h1>
        <div class="controls-top">
            <select id="reciterSelect">
                <option value="ar.alafasy">ŸÖÿ¥ÿßÿ±Ÿä ÿßŸÑÿπŸÅÿßÿ≥Ÿä</option>
                <option value="ar.abdulbasitmurattal">ÿπÿ®ÿØ ÿßŸÑÿ®ÿßÿ≥ÿ∑ (ŸÖÿ±ÿ™ŸÑ)</option>
                <option value="ar.husary">ŸÖÿ≠ŸÖŸàÿØ ÿÆŸÑŸäŸÑ ÿßŸÑÿ≠ÿµÿ±Ÿä</option>
                <option value="ar.minshawi">ŸÖÿ≠ŸÖÿØ ÿµÿØŸäŸÇ ÿßŸÑŸÖŸÜÿ¥ÿßŸàŸä</option>
            </select>
            <button onclick="scrollToActive()" class="juz-btn" style="width: auto; padding: 0 15px; font-size: 0.9rem;">üìç ÿßŸÑÿ¢Ÿäÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©</button>
        </div>
        <p>Powered By Hadi Koubaissi</p>
    </header>

    <div class="juz-selector" id="juzGrid"></div>

    <div class="mushaf-container">
        <div id="loader" class="loading-overlay">
            <div class="spinner"></div>
        </div>
        <div id="ayahList" class="ayah-list">
            <div style="text-align: center; padding: 40px; color: #888;">
                ÿßÿÆÿ™ÿ± ÿ¨ÿ≤ÿ°ÿßŸã ŸÑŸÑÿ®ÿØÿ°
            </div>
        </div>
    </div>
</div>

<button id="scrollTopBtn" class="scroll-top-btn" onclick="scrollToTop()" title="ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ£ÿπŸÑŸâ">
    ‚Üë
</button>

<div class="player-dock">
    <div class="player-info">
        <span id="playerSurahName" class="current-surah">...</span>
        <span id="playerAyahNum">...</span>
    </div>
    
    <div class="audio-controls-wrapper">
        <button class="nav-btn" onclick="playPrev()" title="ÿßŸÑÿ¢Ÿäÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©">‚ùÆ</button>
        <audio id="mainAudio" controls controlsList="nodownload"></audio>
        <button class="nav-btn" onclick="playNext()" title="ÿßŸÑÿ¢Ÿäÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©">‚ùØ</button>
    </div>
</div>

<script>
    // --- Configuration & State ---
    const STATE = {
        reciter: localStorage.getItem('quran_reciter') || 'ar.alafasy',
        currentJuz: 1,
        currentAyahIndex: 0,
        juzData: [],
        isPlaying: false
    };

    // --- DOM Elements ---
    const elements = {
        audio: document.getElementById('mainAudio'),
        juzGrid: document.getElementById('juzGrid'),
        ayahList: document.getElementById('ayahList'),
        loader: document.getElementById('loader'),
        reciterSelect: document.getElementById('reciterSelect'),
        surahName: document.getElementById('playerSurahName'),
        ayahNum: document.getElementById('playerAyahNum'),
        scrollBtn: document.getElementById('scrollTopBtn')
    };

    // --- Initialization ---
    function init() {
        // Generate Juz Buttons
        for (let i = 1; i <= 30; i++) {
            const btn = document.createElement('button');
            btn.className = 'juz-btn';
            btn.textContent = i;
            btn.onclick = () => loadJuz(i);
            btn.id = `juz-btn-${i}`;
            elements.juzGrid.appendChild(btn);
        }

        // Restore Settings
        elements.reciterSelect.value = STATE.reciter;
        
        // Restore Last Session
        const savedJuz = localStorage.getItem('quran_juz');
        const savedIndex = localStorage.getItem('quran_index');
        
        if (savedJuz) {
            loadJuz(parseInt(savedJuz), parseInt(savedIndex) || 0, false);
        }

        // Event Listeners
        elements.audio.onended = handleAyahEnd;
        elements.audio.onplay = () => STATE.isPlaying = true;
        elements.audio.onpause = () => STATE.isPlaying = false;
        
        elements.reciterSelect.onchange = (e) => {
            STATE.reciter = e.target.value;
            localStorage.setItem('quran_reciter', STATE.reciter);
            if (STATE.juzData.length > 0) {
                loadJuz(STATE.currentJuz, STATE.currentAyahIndex, true); 
            }
        };

        // Scroll Event for Button Visibility
        window.addEventListener('scroll', toggleScrollButton);

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                STATE.isPlaying ? elements.audio.pause() : elements.audio.play();
            } else if (e.code === 'ArrowLeft') {
                playNext();
            } else if (e.code === 'ArrowRight') {
                playPrev();
            }
        });
    }

    // --- Scroll Functions ---
    function toggleScrollButton() {
        if (window.scrollY > 300) {
            elements.scrollBtn.classList.add('visible');
        } else {
            elements.scrollBtn.classList.remove('visible');
        }
    }

    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }

    // --- Core Logic ---

    async function loadJuz(juzNumber, startIndex = 0, autoPlay = true) {
        try {
            elements.loader.classList.add('visible');
            
            // Update UI State
            document.querySelectorAll('.juz-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`juz-btn-${juzNumber}`)?.classList.add('active');

            STATE.currentJuz = juzNumber;
            
            const response = await fetch(`https://api.alquran.cloud/v1/juz/${juzNumber}/${STATE.reciter}`);
            const data = await response.json();
            
            if (data.code !== 200) throw new Error("Failed to fetch");

            STATE.juzData = data.data.ayahs;
            
            renderAyahs();
            playAyah(startIndex, autoPlay);

            localStorage.setItem('quran_juz', juzNumber);

        } catch (error) {
            console.error(error);
            elements.ayahList.innerHTML = `<div style="text-align:center; color:#ff6b6b">‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ.<br>ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑŸÉ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™.</div>`;
        } finally {
            elements.loader.classList.remove('visible');
        }
    }

    function renderAyahs() {
        elements.ayahList.innerHTML = '';
        
        STATE.juzData.forEach((ayah, index) => {
            const div = document.createElement('div');
            div.className = 'ayah-item';
            div.id = `ayah-${index}`;
            div.onclick = () => playAyah(index, true);
            
            div.innerHTML = `
                <div class="ayah-text">${ayah.text}</div>
                <div class="ayah-info">
                    <span>${ayah.surah.name}</span>
                    <span>ÿ¢Ÿäÿ© ${ayah.numberInSurah}</span>
                </div>
            `;
            elements.ayahList.appendChild(div);
        });
    }

    function playAyah(index, autoPlay = true) {
        if (index < 0 || index >= STATE.juzData.length) return;

        STATE.currentAyahIndex = index;
        const ayah = STATE.juzData[index];

        elements.audio.src = ayah.audio;
        if (autoPlay) elements.audio.play();

        highlightActiveAyah(index);
        elements.surahName.innerText = ayah.surah.name;
        elements.ayahNum.innerText = `ÿßŸÑÿ¢Ÿäÿ© ${ayah.numberInSurah}`;

        localStorage.setItem('quran_index', index);
        
        if (index + 1 < STATE.juzData.length) {
            const nextAudio = new Audio();
            nextAudio.src = STATE.juzData[index + 1].audio;
        }
    }

    function highlightActiveAyah(index) {
        document.querySelectorAll('.ayah-item').forEach(el => el.classList.remove('active'));
        const activeEl = document.getElementById(`ayah-${index}`);
        if (activeEl) {
            activeEl.classList.add('active');
            scrollToActive();
        }
    }

    function scrollToActive() {
        const activeEl = document.getElementById(`ayah-${STATE.currentAyahIndex}`);
        if (activeEl) {
            activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    function handleAyahEnd() {
        if (STATE.currentAyahIndex < STATE.juzData.length - 1) {
            playAyah(STATE.currentAyahIndex + 1, true);
        } else {
            if (STATE.currentJuz < 30) {
                loadJuz(STATE.currentJuz + 1, 0, true);
            } else {
                alert("ÿµÿØŸÇ ÿßŸÑŸÑŸá ÿßŸÑÿπÿ∏ŸäŸÖ - ÿ£ÿ™ŸÖŸÖÿ™ ÿßŸÑÿÆÿ™ŸÖÿ© ÿ®ŸÅÿ∂ŸÑ ÿßŸÑŸÑŸá");
            }
        }
    }

    function playNext() {
        if (STATE.currentAyahIndex < STATE.juzData.length - 1) {
            playAyah(STATE.currentAyahIndex + 1, true);
        } else if (STATE.currentJuz < 30) {
            loadJuz(STATE.currentJuz + 1, 0, true);
        }
    }

    function playPrev() {
        if (elements.audio.currentTime > 3) {
            elements.audio.currentTime = 0; 
        } else {
            if (STATE.currentAyahIndex > 0) {
                playAyah(STATE.currentAyahIndex - 1, true);
            } else if (STATE.currentJuz > 1) {
                loadJuz(STATE.currentJuz - 1, 0, true);
            }
        }
    }

    init();

</script>
</body>
</html>